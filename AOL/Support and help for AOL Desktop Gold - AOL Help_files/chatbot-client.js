!function(){"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};var t=function(){return t=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function n(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{c(i.next(e))}catch(e){r(e)}}function a(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((i=i.apply(e,t||[])).next())}))}function i(e,t){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function r(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,o,r=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(e){o={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}function s(e,t,n){if(n||2===arguments.length)for(var i,o=0,r=t.length;o<r;o++)!i&&o in t||(i||(i=Array.prototype.slice.call(t,0,o)),i[o]=t[o]);return e.concat(i||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var a=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c=function(e){return!!e&&e.constructor===Object},l=function(e,t,n,i){for(var o in void 0===n&&(n=!1),void 0===i&&(i=!1),e)if(a(e,o)&&a(t,o))if(c(e[o]))l(e[o],t[o],n,i);else{var r=t[o];!n||"true"!==r&&"false"!==r||(r="true"===r),i&&"string"==typeof r&&/^[0-9]+(.[0-9]+?)$/.test(r)&&(r=Number(r)),e[o]=r}};function h(e,n){var i=d(e),o=encodeURIComponent(JSON.stringify(t(t({},i),n)));document.cookie="".concat(e,"=").concat(o,"; path=/; SameSite=Lax; Secure")}function d(e,t){var n,i=null===(n=document.cookie.split("; ").find((function(t){return t.startsWith("".concat(e,"="))})))||void 0===n?void 0:n.split("=")[1];if(i)try{var o=JSON.parse(decodeURIComponent(i));if("object"==typeof o&&null!==o)return t?void 0!==o[t]?o[t]:null:o}catch(e){console.error("Error parsing cookie:",e)}return null}var u,p,f;!function(e){e.CLIENT_READY="CLIENT_READY",e.CHAT_WINDOW_SHOWN="CHAT_WINDOW_SHOWN",e.WINDOW_FOCUS="WINDOW_FOCUS",e.DATA="DATA",e.TRACK_EVENTS="TRACK_EVENTS",e.MEDIA_QUERY_LIST_EVENT="MEDIA_QUERY_LIST_EVENT",e.INIT_APP="INIT_APP"}(u||(u={})),function(e){e.BOT_RESPONSE="BOT_RESPONSE",e.BUTTON_CLICK="BUTTON_CLICK",e.CHECK_ACTIVE_WINDOW="CHECK_ACTIVE_WINDOW",e.CLOSE_CHAT_WINDOW="CLOSE_CHAT_WINDOW",e.DATA="DATA",e.GET_ACTIVE_WINDOW_STATUS="GET_ACTIVE_WINDOW_STATUS",e.IFRAME_INJECTED="IFRAME_INJECTED",e.IFRAME_INJECT_ERROR="IFRAME_INJECT_ERROR",e.IFRAME_SERVICE_READY="IFRAME_SERVICE_READY",e.LINK_CLICK="LINK_CLICK",e.OPEN_WINDOW="OPEN_WINDOW",e.TERMINATE_SESSION="TERMINATE_SESSION",e.USER_ACTIVITY="USER_ACTIVITY",e.TRACK_EVENTS="TRACK_EVENTS"}(p||(p={})),function(e){e.PAGE_VIEW="PAGE_VIEW",e.START_SESSION="START_SESSION",e.TERMINATE_SESSION="TERMINATE_SESSION",e.INACTIVITY_DETECTED="INACTIVITY_DETECTED",e.LINK_CLICK="LINK_CLICK",e.BUTTON_CLICK="BUTTON_CLICK",e.SUBMIT_FEEDBACK="SUBMIT_FEEDBACK",e.FLOW_INTERACTION="FLOW_INTERACTION",e.USER_MESSAGE="USER_MESSAGE",e.BOT_RESPONSE="BOT_RESPONSE",e.APP_STATUS="APP_STATUS"}(f||(f={}));var m,v=function(){},E=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i,o=(i=e[0])&&i.stack&&i.message?e[0]:new Error(String(e[0])),r="string"==typeof e[1]?{description:e[1]}:t({},e[1]);try{"newrelic"in window&&window.newrelic.noticeError(o,r)}catch(i){}},y={info:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return v.apply(void 0,s(["info"],r(e),!1))},error:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return v.apply(void 0,s(["error"],r(e),!1))},nr:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return E.apply(void 0,s([],r(e),!1))}},I=function(){function e(e,t,n){var i,o,a;void 0===n&&(n=""),this.isInitialized=!1,this.isReady=!1,this.iFrameResponseCheckInterval=null,this.iFrameResponseTimeout=10,this.iFrameMaxReloadCount=1,this.listenersRegistered=!1,this.popupReference=null,this.allowPopups=!0,this.reusePopupWindow=!0,this.iFrameStyle={css:{width:"100%",height:"100%",bottom:"0px",right:"0px",position:"fixed",zIndex:"1000",boxShadow:""},mediaModes:[{mode:"desktop",media:"(min-width: 745px) and (min-height: 485px)"}]},this.handleIFrameMessageRef=this.handleIFrameMessage.bind(this),this.throttledHandleWindowFocus=(i=this.handleWindowFocus.bind(this),o=250,a=0,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=(new Date).getTime();if(!(n-a<o))return a=n,i.apply(void 0,s([],r(e),!1))}),this.handleVisibilityChangeRef=this.handleVisibilityChange.bind(this);var c=this.extractDomain(n);if(null===c)throw new Error("Invalid iFrameUrl domain");this.eventEmitter=e,this.eventTracker=t,this.allowedOrigin=c,this.iFrameUrl=n,this.windowId=crypto.randomUUID(),this.eventTracker.addCommonProperties("windowId",this.windowId)}return e.prototype.getFromIframe=function(e,t){var n=this;return void 0===t&&(t={}),new Promise((function(i,o){var r=crypto.randomUUID(),s=void 0,a=function(e){e.messageId===r&&(clearTimeout(s),n.off(p.DATA,a),i(e.message))};n.on(p.DATA,a),n.sendToIFrame(e,r,t),s=window.setTimeout((function(){o('Error waiting for "'.concat(e,'", waited ').concat(5e3))}),5e3)}))},e.prototype.injectIFramePromisified=function(){var e=this;return new Promise((function(t,n){var i=function(){e.off(p.IFRAME_INJECT_ERROR,o),t(!0)},o=function(t){e.off(p.IFRAME_SERVICE_READY,i),n(t)};e.injectIFrame(),e.once(p.IFRAME_SERVICE_READY,i),e.once(p.IFRAME_INJECT_ERROR,o)}))},e.prototype.injectIFrame=function(){this.listenersRegistered||this.registerListeners(),this.log("Injecting iFrame with URL: %s",this.iFrameUrl),this.iFrame=document.createElement("iframe"),this.iFrame.src=this.iFrameUrl,this.iFrame.setAttribute("id",this.makeUniqueId(this.iFrameId||"ais-iframe")),this.iFrame.setAttribute("referrerPolicy","strict-origin"),this.iFrame.style.display="none",this.iFrame.style.position=this.iFrameStyle.css.position,this.iFrame.style.width=this.iFrameStyle.css.width,this.iFrame.style.height=this.iFrameStyle.css.height,this.iFrame.style.bottom=this.iFrameStyle.css.bottom,this.iFrame.style.right=this.iFrameStyle.css.right,this.iFrame.style.zIndex=this.iFrameStyle.css.zIndex,this.iFrame.style.boxShadow=this.iFrameStyle.css.boxShadow,this.iFrame.style.border="0",this.iFrame.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(this.iFrame),this.checkIFrameInitialization()},e.prototype.setupPageMask=function(){this.pageMaskElementReference=document.createElement("div"),this.pageMaskElementReference.classList.add("ais-chatbot-page-mask"),document.body.append(this.pageMaskElementReference)},e.prototype.checkIFrameInitialization=function(){var e=this;this.log("Waiting %s seconds for iFrame to load..",this.iFrameResponseTimeout),this.iFrameResponseCheckInterval=window.setTimeout((function(){e.iFrameMaxReloadCount>0?(e.log("Will retry loading the iFrame"),e.iFrame.src=e.iFrameUrl,e.iFrameMaxReloadCount--,e.checkIFrameInitialization()):(e.log("iFrame failed to load, check the URL: %s, check allowedOrigins",e.iFrameUrl),e.emit(p.IFRAME_INJECT_ERROR,"iFrame took too long to respond"),e.handleError("iFrame took too long to respond"))}),1e3*this.iFrameResponseTimeout)},e.prototype.makeUniqueId=function(e){for(var t=e,n=1;document.getElementById(t);)t="".concat(e,"-").concat(n),n++;return t},e.prototype.handleIFrameMessage=function(e){if(this.allowedOrigin!==e.origin)return!1;switch(e.data.eventType){case p.IFRAME_INJECTED:window.clearInterval(this.iFrameResponseCheckInterval),this.sendToIFrame(u.CLIENT_READY,"",{serviceParameters:t({},this.serviceParameters)}),this.sendTrackingEventsToIFrame();break;case p.IFRAME_SERVICE_READY:this.isReady=!0,this.handleIsReady(e.data.message);break;case p.OPEN_WINDOW:this.allowPopups&&this.openBrowserWindow(e.data.message);break;case p.LINK_CLICK:this.handleLinkClick(e.data.message);break;case p.BUTTON_CLICK:this.handleButtonClick(e.data.message);break;case p.DATA:this.emit(e.data.eventType,e.data.messageId,e.data.message);break;default:this.filterIFrameMessage(e)}},e.prototype.handleWindowFocus=function(){y.info("chatbot:client","Window focused windowId %s",this.windowId),this.sendToIFrame(u.WINDOW_FOCUS)},e.prototype.handleVisibilityChange=function(){"visible"===document.visibilityState&&this.throttledHandleWindowFocus()},e.prototype.extractDomain=function(e){var t="";try{var n=e.match(/^(https?:\/\/[^\/]+)/i);n&&(t=n[1])}catch(e){}return t},e.prototype.setupMatchMedia=function(e){var t=this;e&&e.forEach((function(e){e.mediaQueryList=window.matchMedia(e.media),e.mediaQueryList.addEventListener("change",t.handleMediaQueryListEvent.bind(t,e.mode)),t.handleMediaQueryListEvent(e.mode,{matches:e.mediaQueryList.matches,media:e.mediaQueryList.media})}))},e.prototype.handleMediaQueryListEvent=function(e,t){var n=t.matches;y.info("chatbot:client","mediaQueryList change event fired! mode: %s, matches: %s",e,n),n?(this.iFrame.setAttribute("class","chatbot--mediamode-".concat(e)),this.sendToIFrame(u.MEDIA_QUERY_LIST_EVENT,"",{mediaMode:e})):(this.iFrame.removeAttribute("class"),this.sendToIFrame(u.MEDIA_QUERY_LIST_EVENT,"",{mediaMode:null}))},e.prototype.openBrowserWindow=function(e){},e.prototype.registerListeners=function(){window.addEventListener("message",this.handleIFrameMessageRef),window.addEventListener("focus",this.throttledHandleWindowFocus),window.addEventListener("visibilitychange",this.handleVisibilityChangeRef),this.log("Registered listeners")},e.prototype.unregisterListeners=function(){window.removeEventListener("message",this.handleIFrameMessageRef),window.removeEventListener("focus",this.throttledHandleWindowFocus),window.removeEventListener("visibilitychange",this.handleVisibilityChangeRef),this.log("Unregistered listeners")},e.prototype.sendToIFrame=function(e,t,n){var i;void 0===t&&(t=""),void 0===n&&(n=""),this.iFrame&&(null===(i=this.iFrame.contentWindow)||void 0===i||i.postMessage({eventType:e,messageId:t,message:n},this.iFrameUrl))},e.prototype.hidePageMask=function(){this.pageMaskElementReference&&(this.pageMaskElementReference.style.display="none")},e.prototype.showPageMask=function(){this.pageMaskElementReference&&(this.pageMaskElementReference.style.display="block")},e.prototype.showIFrame=function(){this.listenersRegistered||this.registerListeners(),this.iFrame&&(this.showPageMask(),this.log("Showing iFrame"),this.iFrame.style.display="block",this.setupMatchMedia(this.iFrameStyle.mediaModes))},e.prototype.hideIFrame=function(){this.iFrame.style.display="none",this.hidePageMask(),this.log("Hiding iFrame")},e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.off=function(e,t){this.eventEmitter.off(e,t)},e.prototype.once=function(e,t){this.eventEmitter.once(e,t)},e.prototype.sendTrackingEventsToIFrame=function(){return n(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:if(!this.isReady)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),e=this.eventTracker.getState(),[4,this.getFromIframe(p.TRACK_EVENTS,e)];case 2:return n.sent()&&this.eventTracker.clearEvents(),[3,4];case 3:return t=n.sent(),y.error("chatbot:client",t),[3,4];case 4:return[2]}}))}))},e.prototype.filterIFrameMessage=function(e){this.eventEmitter.emit(p.DATA,e)},e.prototype.emit=function(e,t,n){this.eventEmitter.emit(e,n),this.eventEmitter.emit(p.DATA,{status:e,messageId:t,message:n})},e.prototype.handleLinkClick=function(e){this.log("Link clicked: %o",e)},e.prototype.handleButtonClick=function(e){this.log("Button clicked: %o",e)},e.prototype.handleIsReady=function(e){this.log("Client is ready: %o",e)},e.prototype.handleError=function(e){this.log("Error: %s",e)},e.prototype.handleIsInitialized=function(){this.log("Client initialized, assigned windowId: %s",this.windowId)},e.prototype.init=function(e,t){if(void 0===t&&(t={}),this.isInitialized)throw new Error("Widget has already been initialized");this.eventTracker.track({type:f.PAGE_VIEW,details:{userAgent:navigator.userAgent,url:window.location.href}}),this.serviceParameters=t,this.isInitialized=!0,this.handleIsInitialized()},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];y.info.apply(y,s(["chatbot:client"],r(e),!1))},e}(),T=function(t){function s(e,n,i){void 0===i&&(i="");var o=t.call(this,e,n,i)||this;return o.ACTIVE_WINDOW_COOKIE_NAME="ais-chatbot-active",o.buttonReference=null,o.userEmail="",o.tenantName="",o.customEventHandlers={chatWindowInitialized:null,chatWindowOpen:null,chatWindowClose:null,botResponse:null,linkClick:null,buttonClick:null,sessionTerminated:null,ready:null,error:null},o.chatButtonConfig={injectChatButton:!0,selector:""},o.iFrameId="ais-chatbot-iframe",o}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}(s,t),s.prototype.setupCustomEvents=function(e){var t,n;try{for(var i=o(Object.entries(e)),s=i.next();!s.done;s=i.next()){var a=r(s.value,2),c=a[0],h=a[1];if(null!==h&&"function"!=typeof h)throw new Error("Invalid event handler for: ".concat(c))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}l(this.customEventHandlers,e)},s.prototype.handleChatButtonClick=function(){this.showChatWindow(),this.eventTracker.track({type:f.BUTTON_CLICK,details:{intent:"show-chat-window"}}),this.sendTrackingEventsToIFrame()},s.prototype.setupChatButton=function(e){if(l(this.chatButtonConfig,e),e.selector){var t=document.querySelector(e.selector);if(!t)throw new Error("Error: Provided selector does not match any existing button element");this.buttonReference=t,this.buttonReference.classList.add("ais-chatbot-chat-button"),this.buttonReference.addEventListener("click",this.handleChatButtonClick.bind(this))}},s.prototype.injectChatWindowStyles=function(e){try{e.cssUrl&&(document.head.insertAdjacentHTML("beforeend","<style>".concat(e.cssVariables,"</style>")),t=e.cssUrl,new Promise((function(e,n){var i=document.querySelector('link[href="'.concat(t,'"]'));i?e(!0):((i=document.createElement("link")).setAttribute("href",t),i.setAttribute("rel","stylesheet"),i.onload=function(){e(!0)},i.onerror=function(){n(new Error("Could not inject style: ".concat(t)))},document.head.appendChild(i))})))}catch(e){y.error("chatbot:client","Error configuring chat button: %s",e),this.handleError(e)}var t},s.prototype.injectChatButton=function(e){var t;try{this.chatButtonConfig.injectChatButton&&e.buttonHtml&&!this.buttonReference&&(document.body.insertAdjacentHTML("beforeend",e.buttonHtml),this.buttonReference=document.body.querySelector(".ais-chatbot-chat-button"),null===(t=this.buttonReference)||void 0===t||t.addEventListener("click",this.handleChatButtonClick.bind(this)))}catch(e){y.error("chatbot:client","Error configuring chat button: %s",e),this.handleError(e)}},s.prototype.setupOptions=function(e){e.userEmail&&(this.userEmail=e.userEmail),"string"==typeof e.tenantName&&(this.tenantName=e.tenantName)},s.prototype.showChatWindow=function(){var e,t;return n(this,void 0,void 0,(function(){return i(this,(function(n){return this.buttonReference&&this.buttonReference.classList.add("ais-chatbot-chat-button--is-disabled"),this.showIFrame(),null===(t=(e=this.customEventHandlers).chatWindowOpen)||void 0===t||t.call(e),this.sendToIFrame(u.CHAT_WINDOW_SHOWN),[2]}))}))},s.prototype.closeChatWindow=function(){var e,t;this.hideIFrame(),null===(t=(e=this.customEventHandlers).chatWindowClose)||void 0===t||t.call(e),this.buttonReference&&this.buttonReference.classList.remove("ais-chatbot-chat-button--is-disabled")},s.prototype.handleActivity=function(e,t){var n,i;(void 0===t&&(t=0),e===this.tenantName)?(n=this.ACTIVE_WINDOW_COOKIE_NAME,(null===(i=document.cookie.split("; ").find((function(e){return e.startsWith("".concat(n,"="))})))||void 0===i?void 0:i.split("=")[1])||(this.eventTracker.track({type:f.START_SESSION,details:{userAgent:navigator.userAgent,url:window.location.href}}),this.sendTrackingEventsToIFrame()),h(this.ACTIVE_WINDOW_COOKIE_NAME,{windowId:this.windowId,activityTime:(new Date).getTime(),tenantName:this.tenantName,messageHistorySize:t,autoOpenOnce:!1})):y.info("chatbot:client","Tenant name mismatch, expected %s, got %s",this.tenantName,e)},s.prototype.isThisTheActiveWindow=function(e){var t=d(this.ACTIVE_WINDOW_COOKIE_NAME,"windowId");this.sendToIFrame(u.DATA,e,this.windowId===t)},s.prototype.getActiveWindowStatus=function(e){var t=d(this.ACTIVE_WINDOW_COOKIE_NAME),n=t?{tenantName:null==t?void 0:t.tenantName,isThisTheActiveWindow:(null==t?void 0:t.windowId)===this.windowId,messageHistorySize:null==t?void 0:t.messageHistorySize,activityTime:null==t?void 0:t.activityTime}:"";this.sendToIFrame(u.DATA,e,n)},s.prototype.terminateSession=function(e){var n,i,o;y.info("chatbot:client","Session terminated, deleting %s cookie",this.ACTIVE_WINDOW_COOKIE_NAME),null===(i=(n=this.customEventHandlers).sessionTerminated)||void 0===i||i.call(n,{message:e}),t.prototype.unregisterListeners.call(this),this.closeChatWindow(),o=this.ACTIVE_WINDOW_COOKIE_NAME,document.cookie="".concat(o,"=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; SameSite=Lax; Secure")},s.prototype.filterIFrameMessage=function(e){var t,n;switch(e.data.eventType){case p.CLOSE_CHAT_WINDOW:this.closeChatWindow();break;case p.BOT_RESPONSE:null===(n=(t=this.customEventHandlers).botResponse)||void 0===n||n.call(t,e.data.message);break;case p.USER_ACTIVITY:this.handleActivity(this.tenantName,e.data.message);break;case p.CHECK_ACTIVE_WINDOW:this.isThisTheActiveWindow(e.data.messageId);break;case p.TERMINATE_SESSION:this.terminateSession(e.data.message);break;case p.GET_ACTIVE_WINDOW_STATUS:this.getActiveWindowStatus(e.data.messageId);break;case p.DATA:this.emit(e.data.eventType,e.data.messageId,e.data.message)}},s.prototype.handleLinkClick=function(e){var t,n;null===(n=(t=this.customEventHandlers).linkClick)||void 0===n||n.call(t,e)},s.prototype.handleButtonClick=function(e){var t,n;null===(n=(t=this.customEventHandlers).buttonClick)||void 0===n||n.call(t,e)},s.prototype.handleIsReady=function(e){var t,n,i=e.clientAssets,o=e.tenantConfig;if(this.log("iFrame loaded successfully, client is ready, clientAssets: %o, tenant config: %o",i,o),this.injectChatWindowStyles(i),this.injectChatButton(i),(null==o?void 0:o.usePageMask)&&this.setupPageMask(),null===(n=(t=this.customEventHandlers).ready)||void 0===n||n.call(t,i),null==o?void 0:o.autoOpen)this.showChatWindow();else{var r=d(this.ACTIVE_WINDOW_COOKIE_NAME,"autoOpenOnce");!0===r&&(y.info("chatbot:client",'Cookie has value "autoOpenOnce" set to %s, will open chat window automatically, and delete cookie value',r),function(e,t){var n=d(e);if(n){delete n[t];var i=encodeURIComponent(JSON.stringify(n));document.cookie="".concat(e,"=").concat(i,"; path=/; SameSite=Lax; Secure")}}(this.ACTIVE_WINDOW_COOKIE_NAME,"autoOpenOnce"),this.showChatWindow())}},s.prototype.handleError=function(e){var t,n;null===(n=(t=this.customEventHandlers).error)||void 0===n||n.call(t,e)},s.prototype.handleIsInitialized=function(){var e,t;null===(t=(e=this.customEventHandlers).chatWindowInitialized)||void 0===t||t.call(e)},s.prototype.openBrowserWindow=function(e){return n(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t="ais-chatbot",this.reusePopupWindow||(this.popupReference=null,t=e),null===this.popupReference||this.popupReference&&this.popupReference.closed?this.popupReference=window.open(e,t):this.popupReference.location.href=e,this.popupReference&&this.popupReference.focus(),this.popupReference?[3,2]:(h(this.ACTIVE_WINDOW_COOKIE_NAME,{autoOpenOnce:!0}),this.eventTracker.track({type:f.APP_STATUS,details:{setAutoOpenOnce:!0,description:"window.open() was blocked by the browser for url: "+e}}),[4,this.sendTrackingEventsToIFrame()]);case 1:n.sent(),window.location.href=e,n.label=2;case 2:return[2]}}))}))},s.prototype.init=function(e,o){return n(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e&&Object.keys(e).length>0&&(this.setupCustomEvents(e.events),this.setupChatButton(e.chatButton),this.setupOptions(e.options)),t.prototype.init.call(this,{},{tenantName:this.tenantName,userEmail:this.userEmail}),[4,this.injectIFramePromisified()];case 1:return n.sent(),[2]}}))}))},s}(I),w=function(){function e(){this.events={},this.eventCount=0}return e.prototype.emit=function(e,t){if(void 0===t&&(t=""),e in this.events){var n=!1;this.events[e].forEach((function(e){e.fn.apply(null,[t]),e.emitOnce&&(n=!0)})),n&&(this.events[e]=this.events[e].filter((function(e){return!1===e.emitOnce})))}},e.prototype.on=function(e,t,n){void 0===n&&(n=!1),this.events.hasOwnProperty(e)||(this.events[e]=[]),this.events[e].some((function(e){return e.fn===t}))||this.events[e].push({id:this.eventCount++,emitOnce:n,fn:t})},e.prototype.off=function(e,t){this.events.hasOwnProperty(e)&&(this.events[e]=this.events[e].filter((function(e){return e.fn!==t})))},e.prototype.once=function(e,t){this.on(e,t,!0)},e}(),g=function(){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),this.eventsQueue=new Set,this.maxQueueSize=5,this.logTag="chatbot:tracker",this.sendEventsIntervalTime=3e4,this.eventCollectorEndpoint="",this.sendImmediately=!0,this.collectOnly=!1,this.commonProperties=new Map,y.info(this.logTag,"Initializing event tracker.."),this.collectOnly=t,e&&(this.eventCollectorEndpoint=e,this.setupSendTriggers())}return e.prototype.setupSendTriggers=function(){var e=this;window.addEventListener("visibilitychange",(function(){return"hidden"===document.visibilityState&&e.sendEvents()})),this.sendImmediately||(this.sendEventsInterval=window.setInterval(this.shouldSendEvents.bind(this),this.sendEventsIntervalTime),this.logInfo("Will send events every %s seconds",this.sendEventsIntervalTime/1e3))},e.prototype.sendWithBeacon=function(e,t){return n(this,void 0,void 0,(function(){return i(this,(function(n){return[2,new Promise((function(n,i){return navigator.sendBeacon(e,JSON.stringify(t))?n(!0):i("Could not send data with sendBeacon")}))]}))}))},e.prototype.sendWithFetch=function(e,t){return n(this,void 0,void 0,(function(){var n;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,fetch(e,{method:"POST",headers:(n={"Content-Type":"application/json"},n["x-tenant-name"]=window.chatbotIFrame.tenantName,n),body:JSON.stringify(t),credentials:"include",keepalive:!0})];case 1:return i.sent().ok?[2,!0]:[3,3];case 2:return[2,i.sent()];case 3:return[2,!1]}}))}))},e.prototype.logInfo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];y.info.apply(y,s([this.logTag],r(e),!1))},e.prototype.logError=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];y.error.apply(y,s([this.logTag],r(e),!1))},e.prototype.shouldSendEvents=function(){this.eventsQueue.size<this.maxQueueSize||this.sendEvents()},e.prototype.addEvent=function(e){var t,n,i;if(e.timestamp=null!==(i=e.timestamp)&&void 0!==i?i:(new Date).getTime(),e.details=e.details||{},e.details)try{for(var s=o(Array.from(this.commonProperties.entries())),a=s.next();!a.done;a=s.next()){var c=r(a.value,2),l=c[0],h=c[1];e.details[l]=h}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}this.eventsQueue.add(e)},e.prototype.sendEvents=function(){return n(this,void 0,void 0,(function(){var e,t,n,o;return i(this,(function(i){switch(i.label){case 0:if(!this.eventCollectorEndpoint||!this.eventsQueue.size||this.collectOnly)return[2];e=new Set(this.eventsQueue),this.eventsQueue.clear(),y.info(this.logTag,"Tracked event(s): %o",Array.from(e)),i.label=1;case 1:return i.trys.push([1,3,,4]),t="function"==typeof navigator.sendBeacon?this.sendWithBeacon:this.sendWithFetch,n="".concat(this.eventCollectorEndpoint,"?tenantId=").concat(encodeURIComponent(window.chatbotIFrame.tenantName)),[4,t(n,{events:Array.from(e)})];case 2:return i.sent(),[3,4];case 3:return o=i.sent(),e.forEach(this.eventsQueue.add,this.eventsQueue),this.logError("Error sending events: ".concat(o)),[3,4];case 4:return[2]}}))}))},e.prototype.track=function(e){Array.isArray(e)?e.forEach(this.addEvent.bind(this)):this.addEvent(e),this.sendImmediately&&this.sendEvents()},e.prototype.getEvents=function(){return Array.from(this.eventsQueue)},e.prototype.getState=function(){var e={commonProperties:Array.from(this.commonProperties.entries()),events:this.getEvents()};return JSON.parse(JSON.stringify(e))},e.prototype.setState=function(e){this.commonProperties=new Map(e.commonProperties),this.track(e.events)},e.prototype.addCommonProperties=function(e,t){this.commonProperties.set(e,t)},e.prototype.clearEvents=function(){this.eventsQueue.clear()},e.prototype.enableSendingEvents=function(){this.collectOnly&&(this.collectOnly=!1,this.sendEvents())},e.prototype.disableSendingEvents=function(){this.collectOnly=!0},e}(),C=new T(new w,new g,"https://helpchatbot-service.aol.com/iframe?v=2.2.0");window.AIS=window.AIS||{},window.AIS.chatbot={init:C.init.bind(C)},window.AIS.chatbotConfig&&(m=window.AIS.chatbotConfig);try{m&&C.init(m)}catch(e){console.log(e)}}();
